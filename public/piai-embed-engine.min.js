!function(e){"use strict";const t={red:"#800020",gold:"#b8860b",navy:"#002b5c",bg:"#f9f7f5"},n={width:800,height:450,aspect:"16 / 9",theme:t},i={render:function(e){const t=Object.assign({},n,e||{}),{id:i,container:o,width:r,height:s,aspect:a,theme:d,html:l,htmlGenerator:c}=t,h=o||("string"==typeof i?document.getElementById(i):null);if(!h)return;const u=h.id||i,{isIOS:m,isMobile:f}=function(){const e=navigator.userAgent||"",t=/iPad|iPhone|iPod/.test(e)&&!window.MSStream;return{isIOS:t,isMobile:t||/Mobi|Android/i.test(e)}}(),p={default:`width:${r}px;max-width:100%;height:${s}px;margin:20px auto;display:flex;justify-content:center;align-items:center;position:relative;border-radius:16px;border:1px solid ${d.red}26;box-shadow:0 10px 30px ${d.navy}26;overflow:hidden;background:${d.bg};aspect-ratio:${a}`,fullscreen:"position:fixed;top:0;left:0;width:100vw;height:100vh;height:100dvh;margin:0;border-radius:0;z-index:99999;background:#000;border:none;box-shadow:none;display:flex;justify-content:center;align-items:center;overflow:hidden;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)"};!function(e,t){if(!e)return;const n=`piai-style-${e}`;if(document.getElementById(n))return;const i=document.createElement("style");i.id=n,i.textContent=`\n        @media (max-width: 600px){\n          #${e}{\n            width: 100% !important;\n            height: auto !important;\n            aspect-ratio: ${t};\n          }\n        }\n      `,document.head.appendChild(i)}(u,a),h.style.cssText=p.default;const w=document.createElement("div");w.style.cssText=`width:${r}px;height:${s}px;position:relative;transform-origin:center;transition:transform .3s ease;flex-shrink:0`;const g="function"==typeof c?c:()=>l,b={id:u,embedId:u,width:r,height:s,aspect:a,theme:d,isIOS:m},v=g(Object.assign({},b,{isStandalone:!1}));let y=null;if(m&&(y=g(Object.assign({},b,{isStandalone:!0}))),!v)return;let x="";if(m&&y)try{const e=new Blob([y],{type:"text/html"});x=URL.createObjectURL(e)}catch(e){console.error("PiaiEmbed: standalone blob error",e)}const E=new Blob([v],{type:"text/html"}),L=URL.createObjectURL(E),$=document.createElement("iframe");$.src=L,$.style.cssText="width:100%;height:100%;border:none;border-radius:16px;background:#fff",$.scrolling="no",$.setAttribute("loading","lazy"),$.setAttribute("sandbox","allow-scripts allow-same-origin allow-pointer-lock allow-modals allow-popups"),$.setAttribute("allow","fullscreen; clipboard-read; clipboard-write"),x&&($.dataset.iosStandaloneUrl=x),$.onload=function(){try{URL.revokeObjectURL(L)}catch(e){}};let O=!1,k=null;const M=()=>{if(!w||!h)return;if(O){const e=window.innerWidth,t=window.innerHeight;let n=Math.min(e/r,t/s);return(!Number.isFinite(n)||n<=0)&&(n=1),w.style.transform=`scale(${n})`,void(h.style.height=`${t}px`)}if(!f)return w.style.transform="scale(1)",void(h.style.height=`${s}px`);const e=h.getBoundingClientRect(),t=e.width||window.innerWidth,n=Math.max(window.innerHeight-e.top-24,0);let i=t>0?t/r:1;n>0&&(i=Math.min(i,n/s)),i=Math.min(i,1),(!Number.isFinite(i)||i<=0)&&(i=1),w.style.transform=`scale(${i})`,h.style.height=s*i+"px"},R=e=>{O=e,h.style.cssText=e?p.fullscreen:p.default,$.style.boxShadow=e?"0 0 60px rgba(0,0,0,.4)":"none",$.style.borderRadius=e?"0":"16px",M();try{$.contentWindow?.postMessage({type:"fullscreenState",id:u,isFullscreen:e},"*")}catch(e){}},S=e=>{if(e.data&&e.data.id===u&&"toggleFullscreen"===e.data.type){if(m)return;document.fullscreenElement?document.exitFullscreen():O?R(!1):h.requestFullscreen?h.requestFullscreen().then(()=>R(!0)).catch(()=>R(!0)):R(!0)}},j=()=>{m||(document.fullscreenElement===h?R(!0):O&&!document.fullscreenElement&&R(!1))},F=e=>{"Escape"===e.key&&O&&!document.fullscreenElement&&R(!1)},U=()=>{k&&cancelAnimationFrame(k),k=requestAnimationFrame(M)};window.addEventListener("message",S),document.addEventListener("fullscreenchange",j),document.addEventListener("keydown",F),window.addEventListener("resize",U),window.addEventListener("orientationchange",U);const A=new MutationObserver(e=>{for(const t of e)for(const e of t.removedNodes)if(e===h||e.contains&&e.contains(h)){window.removeEventListener("message",S),document.removeEventListener("fullscreenchange",j),document.removeEventListener("keydown",F),window.removeEventListener("resize",U),window.removeEventListener("orientationchange",U),A.disconnect();try{x&&URL.revokeObjectURL(x)}catch(e){}return}});A.observe(document.body,{childList:!0,subtree:!0}),w.appendChild($),h.appendChild(w),M()},defaults:{theme:t,width:n.width,height:n.height,aspect:n.aspect}};e.PiaiEmbed=i}(window);