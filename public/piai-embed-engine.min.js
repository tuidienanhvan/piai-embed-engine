!function(n){"use strict";const e={classic:{name:"classic",primary:"#800020",accent:"#b8860b",secondary:"#002b5c",bg:"#f9f7f5",text:"#002b4a",textLight:"#666666"},educational:{name:"educational",primary:"#2196F3",accent:"#FFC107",secondary:"#4CAF50",bg:"#FFFFFF",text:"#212121",textLight:"#757575"},night:{name:"night",primary:"#A1C2BD",accent:"#1D24CA",secondary:"#A8A1CE",bg:"#19183B",text:"#F9E8C9",textLight:"#9BA4B5"}},i=["classic","educational","night"],t={width:800,height:450,aspect:"16 / 9",themeName:"classic",headExtra:""};function a(n){return e[n]||e[t.themeName]}function r(n){return`\n:root{\n  --piai-primary:${n.primary};\n  --piai-accent:${n.accent};\n  --piai-secondary:${n.secondary};\n  --piai-bg:${n.bg};\n  --piai-text:${n.text};\n  --piai-text-light:${n.textLight};\n}\n*{margin:0;padding:0;box-sizing:border-box}\nbody{\n  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";\n  color:var(--piai-text);\n  background:transparent;\n  overflow:hidden;\n  width:100%;\n  height:100%;\n}\n.piai-wrap{\n  width:100%;\n  height:100%;\n  background:var(--piai-bg);\n  display:flex;\n  flex-direction:column;\n  overflow:hidden;\n  position:relative;        /* ĐỂ LOADER ABSOLUTE BÁM THEO KHUNG EMBED */\n}\n/* Transition màu để đổi theme mượt hơn */\n.piai-wrap,\n.piai-hdr,\n.piai-def,\n.piai-list-item,\n.piai-body{\n  transition:\n    background-color .25s ease,\n    color .25s ease,\n    border-color .25s ease,\n    box-shadow .25s ease;\n}\n.piai-hdr{\n  background:var(--piai-primary);\n  color:#fff;\n  padding:12px 20px;\n  padding-right:100px;\n  font-weight:700;\n  display:flex;\n  align-items:center;\n  border-bottom:3px solid var(--piai-accent);\n  position:relative;\n}\n.piai-hdr>*{margin-right:10px}\n.piai-hdr>*:last-child{margin-right:0}\n.piai-hdr svg{width:20px;height:20px}\n.piai-body{\n  flex:1;\n  padding:15px 20px;\n  overflow-y:auto;\n  overflow-x:hidden;\n  display:flex;\n  flex-direction:column;\n}\n.piai-body>*{margin-bottom:15px}\n.piai-body>*:last-child{margin-bottom:0}\n.piai-body::-webkit-scrollbar{width:6px}\n.piai-body::-webkit-scrollbar-thumb{\n  background:var(--piai-text-light);\n  border-radius:3px;\n}\n.piai-def{\n  background:var(--piai-bg);\n  border-left:5px solid var(--piai-primary);\n  padding:12px 18px;\n  box-shadow:0 4px 10px rgba(0,0,0,0.05);\n  border-radius:0 8px 8px 0;\n  transition:all 0.3s;\n}\n.piai-def:hover{transform:translateY(-2px)}\n.piai-def-title{\n  color:var(--piai-primary);\n  font-weight:700;\n  display:flex;\n  align-items:center;\n  margin-bottom:6px;\n}\n.piai-def-title>*{margin-right:8px}\n.piai-def-title>*:last-child{margin-right:0}\n.piai-def-content{\n  line-height:1.5;\n  font-size:0.95rem;\n}\n.piai-grid{\n  display:flex;\n  flex:1;\n  min-height:0;\n}\n.piai-grid>*{margin-right:20px}\n.piai-grid>*:last-child{margin-right:0}\n.piai-list{\n  flex:1;\n  display:flex;\n  flex-direction:column;\n  overflow-y:auto;\n  list-style:none;\n  padding-left:6px;\n  padding-right:4px;\n}\n.piai-list-item{\n  display:flex;\n  align-items:flex-start;\n  padding:10px 14px;\n  background:var(--piai-bg);\n  border:1px solid var(--piai-text-light);\n  border-radius:8px;\n  font-size:0.9rem;\n  transition:all 0.3s;\n  margin-bottom:8px;\n}\n.piai-list-item:last-child{margin-bottom:0}\n.piai-list-item:hover{\n  transform:translateX(-4px);\n  border-color:var(--piai-accent);\n}\n.piai-list-item>*{margin-right:12px}\n.piai-list-item>*:last-child{margin-right:0}\n.piai-list-item .piai-ico{\n  color:var(--piai-accent);\n  display:flex;\n  margin-top:2px;\n  transition:all 0.3s;\n}\n.piai-list-item:hover .piai-ico{\n  transform:scale(1.15) rotate(8deg);\n}\n.piai-list-item>div{\n  flex:1;\n  min-width:0;\n  word-wrap:break-word;\n}\n.piai-list-item strong{color:var(--piai-primary)}\n.piai-visual{\n  flex:0 0 280px;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n}\n.piai-visual svg{\n  max-width:100%;\n  max-height:100%;\n}\n/* Header buttons */\n.hdr-btn{\n  position:absolute;\n  top:0;\n  z-index:999;\n  width:48px;\n  height:48px;\n  background:transparent;\n  border:none;\n  cursor:pointer;\n  color:var(--piai-accent);\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  transition:all 0.2s;\n}\n.hdr-btn:hover{\n  color:#fff;\n  transform:scale(1.1);\n}\n.hdr-btn svg{width:22px;height:22px}\n.theme-btn{right:24px}\n.fs-btn{right:0}\n\n/* Loader overlay bên trong iframe (do content điều khiển) */\n.piai-loader {\n  position: absolute;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.2); /* Nền tối nhẹ */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  backdrop-filter: blur(4px);\n  -webkit-backdrop-filter: blur(4px);\n  transition: opacity 0.3s ease, visibility 0.3s ease;\n}\n\n.piai-loader.hide {\n  opacity: 0;\n  visibility: hidden;\n}\n\n.piai-loader .loader-inner {\n  padding: 14px 28px;\n  border-radius: 30px;\n  /* Hiệu ứng kính */\n  background: rgba(255, 255, 255, 0.85);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid rgba(255, 255, 255, 0.5); /* Viền sáng nhẹ */\n  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.spinner {\n  width: 24px;\n  height: 24px;\n  border: 3px solid transparent;\n  border-top-color: var(--piai-primary, #007bff);\n  border-right-color: var(--piai-primary, #007bff);\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n\n.loader-text {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #333;\n}\n\n@keyframes spin{to{transform:rotate(360deg)}}\n\n/* Responsive */\n@media (max-width:650px){\n  .piai-grid{flex-direction:column}\n  .piai-grid>*{\n    margin-right:0;\n    margin-bottom:16px;\n  }\n  .piai-grid>*:last-child{margin-bottom:0}\n  .piai-visual{\n    flex:0 0 auto;\n    padding:10px;\n    width:100%;\n  }\n  .piai-hdr{\n    padding:10px 16px;\n    padding-right:100px;\n  }\n}\n`}function o(n,e,i){if(!n)return"";const t=e?`<style>${e}</style>`:"",a=i||"";if(/<!doctype html/i.test(n)){if(e&&n.includes("</head>")){const e=`${t}${a}`;return n.replace("</head>",e+"</head>")}return n}return`<!DOCTYPE html>\n<html lang="vi">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width,initial-scale=1">\n  ${t}\n  ${a}\n</head>\n<body>\n${n}\n</body>\n</html>`}function s(n,e,i,t){return{default:`width:${e}px;max-width:100%;height:${i}px;margin:20px auto;display:flex;justify-content:center;align-items:center;position:relative;border-radius:16px;border:1px solid ${n.primary||"#800020"}26;box-shadow:0 10px 30px ${n.navy||n.secondary||"#002b5c"}26;overflow:hidden;background:${n.bg||"#f9f7f5"};aspect-ratio:${t}`,fullscreen:"position:fixed;top:0;left:0;width:100vw;height:100vh;height:100dvh;margin:0;border-radius:0;z-index:99999;background:#000;border:none;box-shadow:none;display:flex;justify-content:center;align-items:center;overflow:hidden;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)"}}const d={render:function(n){const e=Object.assign({},t,n||{}),{id:d,container:l,width:c,height:p,aspect:h,themeName:m,theme:g,html:f,htmlGenerator:b,headExtra:x,onReady:u,onThemeChange:y}=e,w=l||("string"==typeof d?document.getElementById(d):null);if(!w)return;const v=w.id||("string"==typeof d?d:"piai_"+Date.now());w.id=v;const k=function(){const n=navigator.userAgent||"",e=/iPad|iPhone|iPod/.test(n)&&!window.MSStream;return{isIOS:e,isMobile:e||/Mobi|Android/i.test(n)}}(),E=k.isIOS;k.isMobile;let L=g||a(m),F=L.name||m||t.themeName,$=r(L),N=s(L,c,p,h);w.style.cssText=N.default;const S=document.createElement("div");S.style.cssText=`width:${c}px;height:${p}px;position:relative;transform-origin:center;transition:transform .3s ease;flex-shrink:0`;const A="function"==typeof b?b:()=>f,C={id:v,embedId:v,width:c,height:p,aspect:h,theme:L,themeName:F,baseCss:$,isIOS:E},O=A(Object.assign({},C,{isStandalone:!1}));if(!O)return;const R=o(O,$,x);let T=null,j="";if(E){const n=A(Object.assign({},C,{isStandalone:!0}));if(n){T=o(n,$,x);try{const n=new Blob([T],{type:"text/html"});j=URL.createObjectURL(n)}catch(n){console.error("PiaiEmbed: standalone blob error",n)}}}const U=new Blob([R],{type:"text/html"}),B=URL.createObjectURL(U),M=document.createElement("iframe");M.src=B,M.style.cssText="width:100%;height:100%;border:none;border-radius:16px;background:#fff",M.scrolling="no",M.loading="lazy",M.sandbox="allow-scripts allow-same-origin allow-pointer-lock allow-modals allow-popups",M.allow="fullscreen; clipboard-read; clipboard-write",j&&(M.dataset.iosStandaloneUrl=j),M.onload=function(){try{URL.revokeObjectURL(B)}catch(n){}try{M.contentWindow&&M.contentWindow.postMessage({type:"piaiApplyTheme",id:v,themeName:F,theme:L},"*")}catch(n){}if("function"==typeof u)try{u(M,{id:v,themeName:F,theme:L})}catch(n){console.error("PiaiEmbed onReady callback error:",n)}};let z=!1,I=null;const P=()=>{const n=w.getBoundingClientRect(),e=n.width||window.innerWidth,i=Math.max(window.innerHeight-n.top-24,0);let t;t=z?Math.min(window.innerWidth/c,window.innerHeight/p):Math.min(e/c,i/p,1),(!Number.isFinite(t)||t<=0)&&(t=1),S.style.transform=`scale(${t})`,w.style.height=p*t+"px"},W=n=>{z=n,w.style.cssText=n?N.fullscreen:N.default,M.style.boxShadow=n?"0 0 60px rgba(0,0,0,.4)":"none",M.style.borderRadius=n?"0":"16px",P();try{M.contentWindow&&M.contentWindow.postMessage({type:"fullscreenState",id:v,isFullscreen:n},"*")}catch(n){}},H=n=>{if(n.data&&n.data.id===v)if("toggleFullscreen"!==n.data.type)"switchTheme"!==n.data.type||(()=>{let n=i.indexOf(F);n<0&&(n=0);const e=i[(n+1)%i.length];F=e,L=a(e),$=r(L),N=s(L,c,p,h),w.style.cssText=z?N.fullscreen:N.default,M.style.boxShadow=z?"0 0 60px rgba(0,0,0,.4)":"none",M.style.borderRadius=z?"0":"16px",P();try{M.contentWindow&&M.contentWindow.postMessage({type:"piaiApplyTheme",id:v,themeName:F,theme:L},"*")}catch(n){}if("function"==typeof y)try{y(F,L)}catch(n){console.error("PiaiEmbed onThemeChange callback error:",n)}})();else{if(E)return;document.fullscreenElement?document.exitFullscreen():z?W(!1):w.requestFullscreen?w.requestFullscreen().then(function(){W(!0)}).catch(function(){W(!0)}):W(!0)}},D=()=>{E||(document.fullscreenElement===w?W(!0):z&&!document.fullscreenElement&&W(!1))},q=n=>{"Escape"===n.key&&z&&!document.fullscreenElement&&W(!1)},G=()=>{I&&cancelAnimationFrame(I),I=requestAnimationFrame(P)};window.addEventListener("message",H),document.addEventListener("fullscreenchange",D),document.addEventListener("keydown",q),window.addEventListener("resize",G),window.addEventListener("orientationchange",G);const Y=new MutationObserver(n=>{for(const e of n)for(const n of e.removedNodes)if(n===w||n.contains&&n.contains(w)){window.removeEventListener("message",H),document.removeEventListener("fullscreenchange",D),document.removeEventListener("keydown",q),window.removeEventListener("resize",G),window.removeEventListener("orientationchange",G),Y.disconnect();try{j&&URL.revokeObjectURL(j)}catch(n){}return}});Y.observe(document.body,{childList:!0,subtree:!0}),S.appendChild(M),w.appendChild(S),P()},themes:e,getThemeByName:a,getBaseCss:r,defaults:{width:t.width,height:t.height,aspect:t.aspect,themeName:t.themeName}};n.PiaiEmbed=d}(window);